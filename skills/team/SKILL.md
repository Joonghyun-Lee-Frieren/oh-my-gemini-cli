# $team — 멀티 에이전트 팀 오케스트레이션 스킬

작업 분석 결과에 따라 여러 에이전트를 동시에 생성하고 조율하여 대규모 작업을 병렬 처리합니다.

## 트리거

`$team` 키워드로 활성화됩니다.

```
$team "OAuth 인증 기능을 구현해줘"
$team 3:executor "TypeScript 마이그레이션을 병렬로 진행해줘"
$team architect,executor,reviewer "API 리팩토링"
```

## 구문

```
$team [옵션] "작업 설명"

옵션:
  N:type         — 특정 타입의 에이전트를 N개 생성 (예: 3:executor)
  type1,type2    — 특정 에이전트 조합 지정 (예: architect,executor,reviewer)
  (생략)         — 작업 분석 기반 자동 에이전트 할당
```

## 실행 프로세스

### Phase 1: 작업 분석 (Gemini 3.1 Pro)

```
사용자 요청
    │
    ▼
┌─────────────┐
│  TaskRouter  │  작업 유형 분류 및 복잡도 평가
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  Planner    │  작업 분해 + 의존성 그래프 생성
└──────┬──────┘
       │
       ▼
  에이전트 팀 구성 결정
```

### Phase 2: 팀 구성

작업 분석 결과에 따라 자동으로 팀을 구성합니다:

| 작업 복잡도 | 기본 팀 구성 |
|------------|-------------|
| 단순 (1 Phase) | Executor × 1 |
| 보통 (2-3 Phases) | Planner + Executor × 2 + Reviewer |
| 복잡 (4+ Phases) | Architect + Planner + Executor × 3 + Reviewer + Debugger |

### Phase 3: 파이프라인 실행

```
┌──────────────────────────────────────────────────────┐
│                   TaskQueue                           │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐          │
│  │ T-1 │ │ T-2 │ │ T-3 │ │ T-4 │ │ T-5 │ ...      │
│  └──┬──┘ └──┬──┘ └──┬──┘ └──┬──┘ └──┬──┘          │
└─────┼───────┼───────┼───────┼───────┼──────────────┘
      │       │       │       │       │
      ▼       ▼       ▼       ▼       ▼
┌──────────────────────────────────────────────────────┐
│                  AgentPool (max 6)                     │
│  ┌────────┐ ┌────────┐ ┌────────┐                    │
│  │Agent #1│ │Agent #2│ │Agent #3│  ...                │
│  │(Flash) │ │(Flash) │ │(Pro)   │                     │
│  └────────┘ └────────┘ └────────┘                    │
└──────────────────────────────────────────────────────┘
```

### Phase 4: 조율 및 결과 수집

- 각 에이전트의 완료를 EventBus로 감지합니다
- 의존성이 해소된 작업을 자동으로 다음 에이전트에 할당합니다
- 실패한 작업은 최대 3회 재시도 후 에스컬레이션합니다
- 모든 작업 완료 시 종합 보고서를 생성합니다

## 결과 보고서

```markdown
## 팀 실행 보고서

### 요약
- 총 작업: N개
- 성공: N개, 실패: N개
- 총 소요 시간: Xm (순차 예상: Ym)
- 에이전트: N개 사용

### 타임라인
| 시간 | 에이전트 | 작업 | 상태 |
|------|---------|------|------|
| 00:00 | Planner | 작업 분해 | ✅ |
| 00:15 | Executor#1 | auth/oauth.ts | ✅ |
| 00:15 | Executor#2 | auth/token.ts | ✅ |
| 00:30 | Reviewer | 코드 리뷰 | ✅ |

### 변경 파일 목록
- `src/auth/oauth.ts` (생성)
- `src/auth/token.ts` (생성)
- `src/routes/index.ts` (수정)

### 캐시 효율
- 캐시 적중률: 94.2%
- 절약 토큰: 45,000
```

## 컨텍스트 엔지니어링 전략

### 서브에이전트 패턴

메인 세션의 캐시를 보존하면서 서브에이전트를 생성합니다:

```
메인 세션 (Pro) — 캐시 유지
  ├─→ 서브에이전트 #1 (Flash) — 독립 캐시
  ├─→ 서브에이전트 #2 (Flash) — 독립 캐시
  └─→ 결과 수집 → 메인 세션 복귀
```

### 핸드오프 최적화

에이전트 간 작업을 전달할 때 컨텍스트를 최소화합니다:
- 전체 대화가 아닌 **핵심 결과만** 전달
- 작업 명세는 구조화된 JSON으로 전달
- 공유 파일 목록만 참조로 전달 (파일 내용은 각 에이전트가 직접 읽음)

## 안전장치

- 동시 에이전트 수는 최대 6개로 제한합니다
- 비용 상한을 초과하면 자동으로 일시 중지합니다
- 같은 파일을 여러 에이전트가 동시에 수정하지 않도록 락을 관리합니다
